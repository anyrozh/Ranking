# Проект: Поисковая система

- **Архитектура:** KNRM  
- **Микросервис:** Flask  

---

## 1. Разработка микросервисной архитектуры

### Эндпоинты

#### `/ping`  
Проверяет, что система работает.

---

#### `/update_index` — создание поискового индекса

**Вход:**

{ "documents": { "id1": "text1", "id2": "text2" } } 

##### 1. Препроцессинг каждого документа

- Удаление пунктуации  
- Приведение к нижнему регистру  
- Токенизация (`nltk.word_tokenize`)

##### 2. Векторизация для FAISS

- Для каждого токена ищем вектор в GloVe  
- Усредняем векторы токенов документа  
- Нормализуем L2 (для косинусного сходства)

##### 3. Создание FAISS-индекса

- `IndexFlatIP` (Inner Product ≈ косинусное сходство при L2-нормировке)  
- Добавление всех векторов документов  
- Сохранение отображения: `id → текст`

**Выход:**

{ "status": "ok", "index_size": N } 

---

#### `/query` — поиск похожих вопросов

**Вход:**

{ "queries": ["query1", "query2", "..."] } 

##### 1. Фильтрация по языку (LangDetect)

- `detect(query) → язык`  
- Если язык не `"en"` → возвращаем `None` (или пустой результат для этого запроса)

##### 2. FAISS-поиск (быстрый поиск кандидатов)

- Векторизация запроса (аналогично п. 1.2 для документов)  
- Поиск 100 ближайших соседей  
- Возврат кандидатов в формате: `(id, текст)`

##### 3. KNRM-реранжирование (точное ранжирование)

- Токенизация запроса и кандидатов  
- Конвертация в индексы через словарь  
- `padding` до 30 токенов  
- Пакетная обработка через KNRM  
- Предсказание релевантности  
- Сортировка по убыванию `score`

##### 4. Формирование ответа

- Берём топ-10 результатов  
- Формат ответа:

text [(id1, text1), (id2, text2), ...] 

---

## 2. Поисковая система: `QuestionSearchSystem`

Основные компоненты:

- **FAISS index** — быстрый поиск кандидатов  
- **KNRM** — точное ранжирование  
- **LangDetect** — фильтрация по языку  
- **GloVe** — векторизация текстов (запросов и документов)

---

## 3. Поступление `query`

1. Приходит запрос в `/query`  
2. Фильтрация по языку (только `"en"`)  
3. Быстрый поиск кандидатов через FAISS  
4. Реранжирование кандидатов через KNRM  
5. Возврат топ-10 наиболее релевантных результатов
