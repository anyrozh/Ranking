# Проект: Поисковая система

- **Архитектура:** KNRM
  KNRM — это нейросетевая архитектура для ранжирования текстов, основанная на пересечении терминов через ядра.

  1.Матрица взаимодействий - Создаётся матрица попарных косинусных близостей между векторами слов запроса и документа.
  2.Ядра (Kernels) - Применяются мягкие ядра (размытые гауссовы фильтры) к матрице взаимодействий. Каждое ядро "ловит" разные типы семантической близости.
  3.Пулы по ядрам - Для каждого ядра вычисляется суммарный вклад близостей, попадающих в его диапазон. Получается вектор признаков размером = числу ядер.
  4.Обучение - Признаки подаются в полносвязный слой, который обучается на размеченных данных
  
  
- **Микросервис:** Flask  

---

## Эндпоинты

### 1. `/ping` — проверка работоспособности системы

Простой health-check эндпоинт, позволяющий убедиться, что сервис запущен и отвечает.

---

### 2. `/update_index` — создание поискового индекса

#### 2.1 Входные данные

json { "documents": { "id1": "text1", "id2": "text2" } } 

#### 2.2 Препроцессинг каждого документа

- Удаление пунктуации  
- Приведение к нижнему регистру  
- Токенизация (`nltk.word_tokenize`)

#### 2.3 Векторизация для FAISS

- Для каждого токена ищется вектор в GloVe  
- Векторы токенов документа усредняются  
- Результирующий вектор нормализуется по L2  
  (для последующего косинусного сходства через скалярное произведение)

#### 2.4 Создание FAISS-индекса

- Используется `IndexFlatIP` (Inner Product ≈ косинусное сходство при L2-нормировке)  
- В индекс добавляются все векторы документов  
- Сохраняется отображение: `id → текст документа`

#### 2.5 Выходные данные

json { "status": "ok", "index_size": N } 

---

### 3. `/query` — поиск похожих вопросов

#### 3.1 Входные данные

json { "queries": ["query1", "query2", "..."] } 

Обработка выполняется для каждого запроса из массива.

---

#### 3.2 Фильтрация по языку (LangDetect)

- `detect(query) → язык`  
- Если язык не `"en"` → для этого запроса возвращается `None` (или пустой список результатов)

---

#### 3.3 FAISS-поиск (быстрый поиск кандидатов)

- Векторизация запроса (аналогично векторизации документов в п. 2.3)  
- Поиск **100 ближайших соседей** в FAISS-индексе  
- Для каждого кандидата возвращаются:  
  - `id` документа  
  - исходный текст документа

---

#### 3.4 KNRM-реранжирование (точное ранжирование)

- Токенизация запроса и кандидатов  
- Конвертация токенов в индексы через словарь  
- `padding`/обрезка до 30 токенов  
- Пакетная обработка через модель **KNRM**  
- Предсказание релевантности (score) для каждой пары  
- Сортировка кандидатов по убыванию `score`

---

#### 3.5 Формирование ответа

- Берутся **топ-10** наиболее релевантных результатов  
- Формат ответа:

text [(id1, text1), (id2, text2), ...] 
